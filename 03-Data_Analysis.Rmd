---
title: "Step III: Data Analysis"
subtitle: 'Project.title'
author:
  - Nicholas R. Jenkins^[University of California, Riverside]
abstract: |
  This document shows all the code used to analyze the data for this project. 
  All analyses were done using RStudio running **R** version 
  `r R.version$major`.`r R.version$minor` "`r R.version$nickname`". 
  
  Each step has been carefully documented and will replicate the results in the 
  manuscript. The code for this document can be downloaded using the button 
  in the top right corner. For any questions about this code, please contact 
  Nick Jenkins at 
  [nicholas.jenkins@email.ucr.edu](mailto:nicholas.jenkins@email.ucr.edu).
output:
  html_notebook: 
    highlight: monochrome
    theme: simplex
    toc: yes
    code_folding: 
  html_document:
    highlight: monochrome
    theme: simplex
    toc: yes
    code_folding:
  pdf_document:
    toc: yes
  github_document:
    toc: yes
date: "`r format(Sys.time(), '%B %d, %Y')`"
bibliography: /Users/nick/Documents/Research/Articles/biblatex.bib
---

# Environment Preperation

This section clears the current working environment and loads the packages used to visualize the data. I also create the function `comma()` to format any in-line output values to have thousands separators and only two digits. 

```{r setup, warning = FALSE, message = FALSE, results = "hide"}
# Clear Environment -----------------------------------------------------------
rm(list = ls())

# Load Packages ---------------------------------------------------------------
packages <- c("tidyverse", "foreign", "stargazer", "lme4", "nlme", 
              "multilevel", "lfe", "lmtest", "bife",  "survival", "mfx", 
              "multcomp", "lmerTest", "R2jags", "ggmcmc", "ggridges",
              "arm", "AER", "rstanarm", "rstan")
lapply(packages, require, character.only = TRUE)

# Functions -------------------------------------------------------------------
# Inline Formatting
comma <- function(x) format(x, digits = 2, big.mark = ",")

# Inverse Hyperbolic Sin Transformation Function
ihs <- function(x) {
    y <- log(x + sqrt(x ^ 2 + 1))
    return(y)
}
```


# Import Data

This section imports the data cleaned in the "Step I: Data Cleaning" document to begin analyzing the data. 

```{r Data Import}
load("Data/Clean Data/estimation_data.RDa")
```


# Model FItting

```{r Modelling}
vote.01 <- lm(vote_pct ~ no_corp_pacs +  + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16,
              data = estimation.data)

turnout.1 <- lm(vap_turnout ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16,
                  data = estimation.data)

small.01 <- lm(small_indiv ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_dem_house_16 + pct_clinton_16 + tot_voting_age,
               data = estimation.data)

large.01 <- lm(large_indiv ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
               data = estimation.data)

pac.money.01 <- lm(tot_pac_money ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                   data = estimation.data)

buz.pacs.01 <- lm(business_pacs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                  data = estimation.data)

labor.pacs.01 <- lm(labor_pacs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                    data = estimation.data)

ideol.pacs.01 <- lm(ideological_pacs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                    data = estimation.data)

leader.pacs.01 <- lm(leadership_pacs ~ no_corp_pacs * new_member + party,
                     data = estimation.data)

cand.contribs.01 <- lm(candidate_contribs ~ no_corp_pacs + party + new_member,
                       data = estimation.data)

indiv.tot.01 <- lm(net_indiv_total ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                   data = estimation.data)

num.pacs.01 <- lm(num_pac_contribs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                  data = estimation.data)

stargazer(vote.01, turnout.1, small.01, large.01, pac.money.01, buz.pacs.01, labor.pacs.01, ideol.pacs.01, leader.pacs.01, cand.contribs.01, indiv.tot.01, num.pacs.01,
          type = "text")
```

## Propensity Score Matching

```{r}
library(MatchIt)

estimation.data %>%
  group_by(no_corp_pacs) %>%
  dplyr::select(party, new_member, pct_white, pct_black, pct_latino, pct_bachelors, 
         median_hh_income, pct_clinton_16, pct_dem_house_16) %>%
  summarise_all(funs(mean(., na.rm = TRUE)))

m.pc <- glm(no_corp_pacs ~ party + new_member + pct_white + pct_black + 
              pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + 
              pct_dem_house_16,
            family = binomial(link = "probit"),
            data = estimation.data)
summary(m.pc)

propensity.scores <- data_frame(pr_score = predict(m.pc, type = "response"),
                                no_corp_pacs = m.pc$model$no_corp_pacs)
head(propensity.scores)

ggplot(data = propensity.scores, aes(x = pr_score)) +
  geom_histogram() +
  facet_wrap(~ no_corp_pacs)

match.data <- 
  estimation.data %>%
  dplyr::select(no_corp_pacs, party, new_member, pct_white, pct_black, pct_latino, 
         pct_bachelors, median_hh_income, pct_clinton_16, pct_dem_house_16,
         small_indiv, large_indiv, net_indiv_total, vote_pct, tot_pac_money,
         business_pacs, labor_pacs, ideological_pacs, leadership_pacs,
         candidate_contribs, num_pac_contribs, vap_turnout, tot_voting_age) %>%
  na.omit() %>%
  mutate(no_corp_pacs = ifelse(no_corp_pacs == "YES", 1, 0))

mod.match <- matchit(no_corp_pacs ~ party + new_member + pct_white + pct_black + 
                       pct_latino + pct_bachelors + median_hh_income + 
                       pct_clinton_16 + pct_dem_house_16,
                     method = "nearest",
                     data = match.data)
data.match <- match.data(mod.match)

plot(mod.match, type = "hist")

matched.vote.01 <- lm(vote_pct ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16,
              data = data.match)

matched.turnout.01 <- lm(vap_turnout ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16,
              data = data.match)

matched.small.01 <- lm(small_indiv ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
               data = data.match)

matched.large.01 <- lm(large_indiv ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
               data = data.match)

matched.pac.money.01 <- lm(tot_pac_money ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                   data = data.match)

matched.buz.pacs.01 <- lm(business_pacs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                  data = data.match)

matched.labor.pacs.01 <- lm(labor_pacs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                    data = data.match)

matched.ideol.pacs.01 <- lm(ideological_pacs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                    data = data.match)

matched.leader.pacs.01 <- lm(leadership_pacs ~ no_corp_pacs * new_member + party,
                     data = data.match)

matched.cand.contribs.01 <- lm(candidate_contribs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                       data = data.match)

matched.indiv.tot.01 <- lm(net_indiv_total ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                   data = data.match)

matched.num.pacs.01 <- lm(num_pac_contribs ~ no_corp_pacs + party + new_member + pct_white + pct_black + pct_latino + pct_bachelors + median_hh_income + pct_clinton_16 + pct_dem_house_16 + tot_voting_age,
                  data = data.match)

stargazer(matched.vote.01, matched.turnout.01, matched.small.01, matched.large.01, matched.pac.money.01, matched.buz.pacs.01, matched.labor.pacs.01, matched.ideol.pacs.01, matched.leader.pacs.01, matched.cand.contribs.01, matched.indiv.tot.01, matched.num.pacs.01,
          type = "text")
```


# Model Diagnostics

```{r Diagnostics, tidy = TRUE}

```